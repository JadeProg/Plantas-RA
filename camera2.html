<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>üå± AR - Controle Total</title>

  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.2.0/dist/aframe-extras.min.js"></script>
  
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.min.js"></script>

  <style>
    body{ margin:0; overflow:hidden; background:#000; font-family:'Poppins',sans-serif; }
    .media-container { position: fixed; inset: 0; z-index: 1; }
    video, canvas { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; transform: none; }
    a-scene{ position:fixed; inset:0; z-index:2; pointer-events:none;}
    
    /* --- ESTILOS VISUAIS --- */
    .hint { 
        position: fixed; bottom: 140px; left: 50%; transform: translateX(-50%); 
        padding: 12px 24px; border-radius: 30px; 
        font-size: 13px; font-weight: 500;
        z-index: 10; text-align: center; pointer-events: none;
        width: max-content; max-width: 85%;
        background: rgba(20, 20, 20, 0.3);
        backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
        border: 1px solid rgba(255, 255, 255, 0.15);
        color: white;
    }

    .glass-btn {
        position: fixed; z-index: 100;
        display: flex; align-items: center; justify-content: center; gap: 8px;
        padding: 12px 24px; text-decoration: none;
        font-weight: 600; font-size: 14px;
        border-radius: 50px; 
        transition: all 0.3s ease;
        cursor: pointer; user-select: none;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: white;
        text-shadow: 0 1px 2px rgba(0,0,0,0.3);
    }
    .glass-btn:active { transform: scale(0.95); background: rgba(255,255,255,0.2); }

    #backBtn { top: 20px; left: 20px; }
    
    #pinBtn { 
        bottom: 30px; left: 50%; transform: translateX(-50%); 
        width: max-content;
    }
    #pinBtn.pinned {
        background: rgba(255, 50, 50, 0.25); border-color: rgba(255, 100, 100, 0.6);
        box-shadow: 0 0 15px rgba(255, 50, 50, 0.3);
    }

    /* --- CONTROLE DE VELOCIDADE + PAUSE --- */
    #controlsContainer {
        display: none; /* Come√ßa escondido */
        position: fixed; bottom: 90px; left: 50%; transform: translateX(-50%);
        z-index: 100;
        width: 90%; max-width: 350px;
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(10px);
        padding: 15px 20px; border-radius: 20px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        
        display: flex; /* Flexbox para alinhar bot√£o e slider */
        align-items: center; gap: 15px;
        color: white; font-size: 12px; font-weight: bold;
    }

    /* Bot√£o de Pause Pequeno */
    #pauseBtn {
        background: rgba(255,255,255,0.2);
        border: 1px solid rgba(255,255,255,0.4);
        border-radius: 50%; width: 40px; height: 40px;
        display: flex; align-items: center; justify-content: center;
        font-size: 18px; cursor: pointer;
    }

    .slider-wrapper { flex-grow: 1; display: flex; flex-direction: column; gap: 5px; }
    
    input[type=range] { width: 100%; -webkit-appearance: none; appearance: none; background: transparent; }
    input[type=range]::-webkit-slider-thumb {
        -webkit-appearance: none; height: 20px; width: 20px;
        border-radius: 50%; background: #ffffff;
        cursor: pointer; margin-top: -8px; box-shadow: 0 2px 5px rgba(0,0,0,0.3);
    }
    input[type=range]::-webkit-slider-runnable-track {
        width: 100%; height: 4px; cursor: pointer;
        background: rgba(255,255,255,0.3); border-radius: 2px;
    }
  </style>
</head>
<body>

  <a href="modelos.html" id="backBtn" class="glass-btn">‚Üê Voltar</a>
  
  <button id="pinBtn" class="glass-btn">üìç Fixar Posi√ß√£o</button>

  <div id="controlsContainer" style="display: none;">
      <button id="pauseBtn">‚è∏Ô∏è</button>
      
      <div class="slider-wrapper">
          <div style="display:flex; justify-content:space-between; width:100%;">
              <span>Lento</span>
              <span>R√°pido</span>
          </div>
          <input type="range" id="animSpeed" min="0.1" max="3.0" step="0.1" value="1">
      </div>
  </div>

  <div class="media-container">
    <video id="inputVideo" playsinline muted></video>
    <canvas id="outputCanvas"></canvas>
  </div>

  <div class="hint" id="hintText">
    A Planta nascer√° no centro da palma, utilize o polegar e o indicador para controlar a escala!
  </div>

  <a-scene embedded vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false">
    <a-entity id="cam" camera="near:0.01; far:100; fov: 70" position="0 0 0"></a-entity>
    
    <a-entity id="arObject" position="0 0 -2" visible="false">
        <a-entity id="flower" 
                  gltf-model="assets/oxygen.glb" 
                  scale="0 0 0" 
                  position="0 0 0"
                  rotation="50 0 0" 
                  animation-mixer="clip: *; loop: repeat; timeScale: 1">
        </a-entity>
    </a-entity>

    <a-entity light="type:ambient; intensity:1.5;"></a-entity>
    <a-entity light="type:directional; intensity:2;" position="1 4 3"></a-entity>
  </a-scene>

  <script>
    const videoElement = document.getElementById('inputVideo');
    const canvasElement = document.getElementById('outputCanvas');
    const canvasCtx = canvasElement.getContext('2d');
    const arObject = document.getElementById('arObject');
    const flower = document.getElementById('flower');
    const pinBtn = document.getElementById('pinBtn');
    const hintText = document.getElementById('hintText');
    const camEl = document.getElementById('cam');
    
    // Controles UI
    const controlsContainer = document.getElementById('controlsContainer');
    const speedSlider = document.getElementById('animSpeed');
    const pauseBtn = document.getElementById('pauseBtn');

    let currentPos = new THREE.Vector3(0, 0, -2);
    let currentScale = 0;
    let isPinned = false; 
    let handDetected = false; 
    let startX = 0;
    let isPaused = false;

    // --- L√ìGICA PAUSE / PLAY ---
    pauseBtn.addEventListener('click', () => {
        isPaused = !isPaused; // Inverte estado
        if (isPaused) {
            pauseBtn.innerText = "‚ñ∂Ô∏è";
            flower.setAttribute('animation-mixer', 'timeScale', 0); // Para anima√ß√£o
        } else {
            pauseBtn.innerText = "‚è∏Ô∏è";
            // Restaura velocidade do slider
            flower.setAttribute('animation-mixer', 'timeScale', speedSlider.value);
        }
    });

    // --- L√ìGICA SLIDER ---
    speedSlider.addEventListener('input', (e) => {
        // Se estiver pausado, n√£o muda a velocidade agora (muda s√≥ quando der play)
        if (!isPaused) {
            flower.setAttribute('animation-mixer', 'timeScale', e.target.value);
        }
    });

    // --- TOUCH ---
    document.addEventListener('touchstart', (e) => { if(isPinned) startX = e.touches[0].clientX; });
    document.addEventListener('touchmove', (e) => {
        if (isPinned) {
            const deltaX = e.touches[0].clientX - startX;
            flower.object3D.rotation.y += deltaX * 0.01;
            startX = e.touches[0].clientX;
        }
    });

    pinBtn.addEventListener('click', () => {
        const isVisible = arObject.getAttribute('visible');
        if (!isVisible && !isPinned) { alert("Mostre a m√£o primeiro!"); return; }
        
        isPinned = !isPinned; 
        
        if (isPinned) {
            pinBtn.innerText = "üîì Soltar";
            pinBtn.classList.add('pinned');
            hintText.style.display = 'none'; 
            controlsContainer.style.display = 'flex'; // Mostra controles
        } else {
            pinBtn.innerText = "üìç Fixar";
            pinBtn.classList.remove('pinned');
            hintText.style.display = 'block';
            controlsContainer.style.display = 'none'; // Esconde controles
        }
    });

    // --- L√ìGICA AR ---
    function getTriangleCenter(landmarks) {
        const p0 = landmarks[0];
        const p5 = landmarks[5];
        const p17 = landmarks[17];
        return { x: (p0.x + p5.x + p17.x) / 3, y: (p0.y + p5.y + p17.y) / 3 };
    }

    function getHandAperture(landmarks) {
        const dx = landmarks[4].x - landmarks[8].x;
        const dy = landmarks[4].y - landmarks[8].y;
        let scale = Math.max(0, (Math.sqrt(dx*dx + dy*dy) - 0.02) * 15); 
        return Math.min(scale, 0.8); 
    }

    function updateAR(landmarks) {
        if (isPinned) return; 

        arObject.setAttribute('visible', true);
        const center = getTriangleCenter(landmarks);
        const threeCamera = camEl.getObject3D('camera');
        const ndcX = (center.x * 2) - 1;
        const ndcY = -(center.y * 2) + 1;
        const vector = new THREE.Vector3(ndcX, ndcY, 0.5);
        vector.unproject(threeCamera);
        const dir = vector.sub(threeCamera.position).normalize();
        const distance = 2; 
        const targetPos = threeCamera.position.clone().add(dir.multiplyScalar(distance));

        currentPos.lerp(targetPos, 0.2); 
        arObject.object3D.position.copy(currentPos);

        const targetScale = getHandAperture(landmarks);
        currentScale += (targetScale - currentScale) * 0.15; 
        flower.object3D.scale.set(currentScale, currentScale, currentScale);
    }

    const hands = new Hands({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
    hands.setOptions({ maxNumHands: 1, modelComplexity: 0, minDetectionConfidence: 0.5, minTrackingConfidence: 0.5 });

    hands.onResults(results => {
      canvasElement.width = videoElement.videoWidth;
      canvasElement.height = videoElement.videoHeight;
      canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
      
      if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
        handDetected = true;
        const landmarks = results.multiHandLandmarks[0];
        
        if (!isPinned) {
            const p0 = landmarks[0]; const p5 = landmarks[5]; const p17 = landmarks[17];
            canvasCtx.fillStyle = "rgba(255, 255, 255, 0.3)";
            [p0, p5, p17].forEach(p => {
                canvasCtx.beginPath(); canvasCtx.arc(p.x * canvasElement.width, p.y * canvasElement.height, 3, 0, 2 * Math.PI); canvasCtx.fill();
            });
            const center = getTriangleCenter(landmarks);
            canvasCtx.beginPath(); canvasCtx.arc(center.x * canvasElement.width, center.y * canvasElement.height, 4, 0, 2 * Math.PI);
            canvasCtx.fillStyle = "rgba(255, 255, 0, 0.5)"; canvasCtx.fill();
        }
        updateAR(landmarks);
      } else {
        handDetected = false;
        if (!isPinned) { arObject.setAttribute('visible', false); currentScale = 0; }
      }
    });

    const camera = new Camera(videoElement, {
      onFrame: async () => { await hands.send({image: videoElement}); },
      width: 640, height: 480, facingMode: 'environment'
    });
    camera.start(); 
  </script>
</body>
</html>



<!-- git add .
git commit -m "sua mensagem de commit"
git push -u origin main -->